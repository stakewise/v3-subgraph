specVersion: 0.0.5
description: The liquid staking protocol
repository: https://github.com/stakewise/v3-subgraph
schema:
  file: ./schema.graphql
features:
  - ipfsOnEthereumContracts
dataSources:
  - kind: ethereum/contract
    name: VaultFactory
    network: {{ network }}
    source:
      address: '{{ vaultFactory.address }}'
      abi: VaultFactory
      startBlock: {{ vaultFactory.startBlock }}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/vaultFactory.ts
      entities:
        - Vault
        - Network
      abis:
        - name: VaultFactory
          file: ./abis/v3/VaultFactory.json
      eventHandlers:
        - event: VaultCreated(indexed address,indexed address,indexed bool,address,uint256,uint16,string,string)
          handler: handleVaultCreated
  - kind: ethereum/contract
    name: Keeper
    network: {{ network }}
    source:
      address: '{{ keeper.address }}'
      abi: Keeper
      startBlock: {{ keeper.startBlock }}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/keeper.ts
      entities:
        - Vault
        - DaySnapshot
      abis:
        - name: Keeper
          file: ./abis/v3/Keeper.json
      eventHandlers:
        - event: RewardsUpdated(indexed address,indexed bytes32,uint128,uint64,uint64,string)
          handler: handleRewardsUpdated
templates:
  - kind: ethereum/contract
    name: Vault
    network: {{ network }}
    source:
      abi: Vault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/vault.ts
      entities:
        - Vault
        - Allocator
        - ExitRequest
        - DaySnapshot
        - AllocatorAction
      abis:
        - name: Vault
          file: ./abis/v3/Vault.json
        - name: Multicall
          file: ./abis/Multicall.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: Deposit(indexed address,indexed address,uint256,uint256,address)
          handler: handleDeposit
        - event: Redeem(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleRedeem
       # - event: StateUpdated(int256)
       #   handler: handleStateUpdated
        - event: ExitQueueEntered(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleExitQueueEntered
        - event: ExitedAssetsClaimed(indexed address,indexed address,uint256,uint256,uint256)
          handler: handleExitedAssetsClaimed
        - event: ValidatorsRootUpdated(indexed address,indexed bytes32)
          handler: handleValidatorsRootUpdated
        - event: MetadataUpdated(indexed address,string)
          handler: handleMetadataUpdated
        - event: FeeRecipientUpdated(indexed address,indexed address)
          handler: handleFeeRecipientUpdated
        - event: OperatorUpdated(indexed address,indexed address)
          handler: handleOperatorUpdated
  - kind: ethereum/contract
    name: PrivateVault
    network: {{ network }}
    source:
      abi: PrivateVault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/privateVault.ts
      entities:
        - Vault
        - PrivateVaultAccount
      abis:
        - name: PrivateVault
          file: ./abis/v3/PrivateVault.json
      eventHandlers:
        - event: WhitelistUpdated(indexed address,indexed address,bool)
          handler: handleWhitelistUpdated
        - event: WhitelisterUpdated(indexed address,indexed address)
          handler: handleWhitelisterUpdated
  - kind: ethereum/contract
    name: ExitQueue
    network: {{ network }}
    source:
      abi: ExitQueue
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/exitQueue.ts
      entities:
        - VaultCheckpoint
        - DaySnapshot
      abis:
        - name: ExitQueue
          file: ./abis/v3/ExitQueue.json
      eventHandlers:
        - event: CheckpointCreated(uint160,uint96)
          handler: handleCheckpointCreated
  - kind: ethereum/contract
    name: MevEscrow
    network: {{ network }}
    source:
      abi: MevEscrow
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./mappings/mevEscrow.ts
      entities:
        - Vault
        - DaySnapshot
      abis:
        - name: MevEscrow
          file: ./abis/v3/MevEscrow.json
      eventHandlers:
        - event: MevReceived(uint256)
          handler: handleMevReceived
      blockHandlers:
        - handler: handleBlock
